#!/bin/bash
usage(){
    echo "  Usage:"
    echo "     use '$0 dev/qa web/agent'."
    exit 1
}

ENV=$1
MODULE=$2
cd `dirname "$0"`
PRGDIR=`pwd`

if [ "$ENV" = "qa" -a "$ENV" = "dev" ]; then
  echo "Your input is not corrent!"
  usage
  exit 1
fi
if [ "$MODULE" != "web" -a "$MODULE" != "agent" ]; then
  echo "Your input is not corrent!"
  usage
  exit 1
fi

cd /tmp
rm -rf yscheduler
svn co svn://svn.dy/platform/yscheduler/branches/develop yscheduler
cd yscheduler
mvn clean package -DskipTests -P${ENV}

AGENT_HOST="172.20.0.101"
WEB_HOST="172.20.0.100"
AGENT_PORT="22"
USER="ubuntu"
PASSWORD="111111"
DATE=$(date +%Y%m%d_%H%M%S)

if [ "$ENV" == "dev" ]; then
  AGENT_HOST="172.20.0.100"
fi

cd $PRGDIR
if [ "$MODULE" == "web" ]; then
  ./deploy-web.sh $WEB_HOST $USER $PASSWORD $DATE
else
  ./deploy-agent.sh $AGENT_HOST $USER $PASSWORD $DATE
fi
