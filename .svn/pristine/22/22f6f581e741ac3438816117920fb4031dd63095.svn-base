CREATE TABLE `agent` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `ip` varchar(100) NOT NULL,
  `alive` tinyint(1) NOT NULL DEFAULT '1' COMMENT '1表示连接，0表示断开连接',
  `enable` tinyint(1) NOT NULL DEFAULT '1' COMMENT '1表示在线，0表示下线',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='机器表';

CREATE TABLE `attempt` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `task_id` bigint(20) NOT NULL COMMENT '所属任务id',
  `instance_id` bigint(20) NOT NULL COMMENT '任务的一次调度',
  `agent_id` bigint(20) DEFAULT NULL COMMENT '执行机器',
  `status` tinyint(3) NOT NULL COMMENT '1初始，2运行中，3成功，4失败',
  `return_value` int(11) DEFAULT NULL COMMENT '返回值',
  `output` longtext COMMENT '任务的输出',
  `start_time` datetime DEFAULT NULL COMMENT '实际开始时间',
  `end_time` datetime DEFAULT NULL COMMENT '结束时间',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='作业执行表';

CREATE TABLE `authority` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `user_id` bigint(20) NOT NULL,
  `task_id` bigint(20) NOT NULL,
  `mode` tinyint(1) NOT NULL DEFAULT '1' COMMENT '0不可读不可写，1只读，2读写',
  `follow` tinyint(1) NOT NULL DEFAULT '1' COMMENT '1关注2不关注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
   PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='权限表';

CREATE TABLE `dependency` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `task_id` bigint(20) NOT NULL COMMENT '依赖的发起者',
  `on_task_id` bigint(20) NOT NULL COMMENT '被依赖的作业',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

CREATE TABLE `instance` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `task_id` bigint(20) NOT NULL COMMENT '所属任务id',
  `status` tinyint(3) NOT NULL COMMENT '1初始，2运行中，3成功，4失败',
  `schedule_time` datetime NOT NULL COMMENT '预计的调度时间',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='作业调度表';

CREATE TABLE `task` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL COMMENT '任务名称',
  `owner` bigint(20) NOT NULL COMMENT '任务的拥有者',
  `type` tinyint(3) NOT NULL DEFAULT '1' COMMENT '作业的类型',
  `crontab` varchar(100) DEFAULT '' COMMENT 'crontab表达式',
  `command` text NOT NULL COMMENT '命令',
  `agent_id` bigint(11) DEFAULT NULL COMMENT 'host id',
  `status` tinyint(3) NOT NULL DEFAULT '1' COMMENT '任务的状态 1:正常2：挂起3：删除',
  `timeout` int(11) NOT NULL DEFAULT '60' COMMENT '执行超期时间（分）',
  `retry_times` int(11) NOT NULL DEFAULT '1' COMMENT '重试次数',
  `description` varchar(1024) DEFAULT NULL COMMENT '对该任务的描述',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `index_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='任务表';

CREATE TABLE `user` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL DEFAULT '' COMMENT '用户名，可采用邮箱前缀',
  `password` varchar(100) DEFAULT NULL COMMENT '密码',
  `email` varchar(255) NOT NULL DEFAULT '' COMMENT '邮件',
  `telephone` varchar(20) DEFAULT NULL COMMENT '电话号码',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `update_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户表';